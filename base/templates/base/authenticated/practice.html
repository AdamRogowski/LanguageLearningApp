{% extends 'base/layouts/my_lessons_layout.html' %}

{% block tab_content %}
<h2><a href="{% url 'my-lesson-details' my_lesson_id=user_lesson_id %}">{{ user_lesson.lesson.title }}</a></h2>
<p>
    {% if mode == "reverse" %}
        Translate: <strong>{{ question }}</strong>
    {% else %}
        What is the prompt for: <strong>{{ question }}</strong>
    {% endif %}
</p>
<form method="post">
    {% csrf_token %}
    <input type="text" name="answer" autocomplete="off" autofocus>
    <button type="submit">Submit</button>
</form>

<form method="get" action="{% url 'edit-word' user_word.id %}" style="display:inline;">
    <input type="hidden" name="next" value="{% url 'practice' user_lesson_id=user_lesson_id mode=mode %}">
    <button type="submit">Edit This Word</button>
</form>

<!-- Rollout for hint and notes -->
<div>
    <button type="button" onclick="toggleRollout('hint')">Show/Hide Hint</button>
    <div id="hint" style="display:none; margin-bottom:1em;">
        <em>{{ user_word.word.hint|default:"No hint available." }}</em>
    </div>
</div>
<div>
    <button type="button" onclick="toggleRollout('usage')">Show/Hide Usage</button>
    <div id="usage" style="display:none; margin-bottom:1em;">
        <em>{{ user_word.word.usage|default:"No usage example available." }}</em>
        {% if user_word.word.has_usage_audio %}
            <audio id="usage_audio" src="{{ user_word.word.usage_audio.url }}?v={{ user_word.word.updated|date:'U' }}"></audio>
            <button type="button" onclick="document.getElementById('usage_audio').play()">ðŸ”Š Listen to usage</button>
        {% elif user_word.word.usage %}
            <button type="button" disabled title="Audio not generated for this word" class="audio-disabled">ðŸ”‡ No audio</button>
        {% endif %}
    </div>
</div>
<div>
    <button type="button" onclick="toggleRollout('notes')">Show/Hide Notes</button>
    <div id="notes" style="display:none;">
        <em>{{ user_word.notes|default:"No notes available." }}</em>
    </div>
</div>

<form method="post" action="{% url 'cancel-practice' user_lesson_id=user_lesson_id %}">
    {% csrf_token %}
    <button type="submit">Cancel Practice</button>
</form>

<script>
function toggleRollout(id) {
    var el = document.getElementById(id);
    if (el.style.display === "none") {
        el.style.display = "block";
    } else {
        el.style.display = "none";
    }
}

// Keyboard shortcuts for toggling sections
document.addEventListener('keydown', function(event) {
    if (event.key === 'F10') {
        event.preventDefault();
        toggleRollout('hint');
    } else if (event.key === 'F11') {
        event.preventDefault();
        toggleRollout('usage');
        // Play usage audio if available
        var audio = document.getElementById('usage_audio');
        if (audio) {
            audio.play();
        }
    } else if (event.key === 'F12') {
        event.preventDefault();
        toggleRollout('notes');
    }
});
</script>

{% endblock tab_content %}