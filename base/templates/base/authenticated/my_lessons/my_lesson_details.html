{% extends 'base/layouts/my_lessons_layout.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'styles/pages/lesson-details.css' %}">
{% endblock %}

{% block tab_content %}

<!-- Lesson Header Box -->
<div class="lesson-header-box">
    <div class="lesson-description">
        <p>{{ my_lesson.lesson.description|default:"No description available." }}</p>
    </div>
    <div class="lesson-actions">
        <div class="dropdown">
            <button class="dropdown-btn" data-menu="lesson-settings">&#9881;</button>
            <div class="dropdown-menu" id="lesson-settings">
                <a href="{% url 'edit-lesson' my_lesson.id %}">Edit Lesson</a>
                <a href="{% url 'move-lesson' my_lesson.id %}?next={% url 'my-lesson-details' my_lesson.id %}">Move Lesson</a>
                <a href="{% url 'reset-progress' my_lesson.id %}">Reset Progress</a>
                <a href="{% url 'generate-lesson-audio-start' my_lesson.id %}">Regenerate Audio</a>
                <a href="{% url 'export-lesson-json' my_lesson.lesson.id %}">Export JSON</a>
                <a href="{% url 'delete-my-lesson' my_lesson.id %}">Delete Lesson</a>
            </div>
        </div>
    </div>
</div>

<!-- Practice Section -->
<div class="practice-section">
    <form method="GET" action="{% url 'start-practice' my_lesson.id 'normal' %}" id="practice-form">
        <button type="submit" class="practice-btn" autofocus>Practice</button>
        <label class="reverse-checkbox" title="The prompt and translation is reversed in this mode">
            <input type="checkbox" id="reverse-practice" onchange="updatePracticeUrl()">
            <span>Reverse</span>
        </label>
    </form>
</div>

<!-- Search and Add Section -->
<div class="search-add-section">
    <form method="GET" action="{% url 'my-lesson-details' my_lesson.id %}" class="search-form">
        <input type="text" name="q" placeholder="Search words...">
        <button type="submit" class="search-btn">üîç</button>
    </form>
    {% if can_edit %}
    <a href="{% url 'create-word' my_lesson.id %}" class="add-btn" title="Add new word">+</a>
    {% endif %}
</div>
 

<div class="my-lesson-container">

    <!-- Words List Header -->
    <div class="words-header">
        <div class="word-prompt-header">Prompt ({{my_lesson.lesson.prompt_language}})</div>
        <div class="word-translation-header">Translation ({{my_lesson.lesson.translation_language}})</div>
        <div class="word-actions-header"></div>
    </div>

    <!-- Words List -->
    <div class="words-list">
        {% for my_word in my_words %}
            <div class="word-item" data-url="{% url 'my-word-details' my_word.id %}">
                <div class="word-prompt">{{ my_word.word.prompt }}</div>
                <div class="word-translation">{{ my_word.word.translation }}</div>
                <div class="word-actions" onclick="event.stopPropagation()">
                    <div class="dropdown">
                        <button class="dropdown-btn" data-menu="word-{{ my_word.id }}">&#9881;</button>
                        <div class="dropdown-menu" id="word-{{ my_word.id }}">
                            <a href="{% url 'edit-word' my_word.id %}">Edit</a>
                            <a href="{% url 'delete-word' my_word.id %}">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

</div>

{% block extra_js %}
<script>
// Update practice URL based on reverse checkbox
function updatePracticeUrl() {
    window.LLApp.updatePracticeUrl(
        '{% url "start-practice" my_lesson.id "normal" %}',
        '{% url "start-practice" my_lesson.id "reverse" %}'
    );
}
</script>
{% endblock extra_js %}

{% endblock tab_content %}
