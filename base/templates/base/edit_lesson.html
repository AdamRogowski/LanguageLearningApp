{% extends "main.html" %}

{% block content %}

<h1 class="text-3xl font-bold text-gray-800 mb-6"><a href="{% url 'my-lessons' my_lesson.user.id %}">My lessons</a></h1>
<h2 class="text-xl font-bold text-gray-800 mb-6"><a href="{% url 'my-lesson-details' my_lesson.id %}">{{ my_lesson.lesson.title }}</a></h2>

<a href="{% url 'add-word-to-lesson' my_lesson.id %}">
    <button class="inline-block px-2 py-1 border border-gray-400 rounded bg-[#ddc2b1] text-gray-700 hover:underline hover:bg-gray-300 text-sm transition-all mb-6">Add word(s)</button>
</a>

<a href="{% url 'generate-lesson-audio-start' my_lesson.id %}">
    <button class="inline-block px-2 py-1 border border-gray-400 rounded bg-[#ddc2b1] text-gray-700 hover:underline hover:bg-gray-300 text-sm transition-all mb-6">Regenerate Audio for All Words</button>
</a>

<form method="POST" action="" class="p-4 rounded-lg border-2 border-[#ddc2b1] bg-[#f7ede7] mb-1">
    {% csrf_token %}
    {{ edit_user_lesson_form.as_p }}
    <br>
    <a href="{% url 'my-lesson-details' my_lesson.id %}" style="display:inline;" class="inline-block px-2 py-1 border border-gray-400 rounded bg-[#ddc2b1] text-gray-700 hover:underline hover:bg-gray-300 text-sm transition-all mt-4 mr-2">
        Cancel
    </a>
    <input type="submit" value="Submit" class="inline-block px-2 py-1 border border-gray-400 rounded bg-[#ddc2b1] text-gray-700 hover:underline hover:bg-gray-300 text-sm transition-all" />
</form>

<h3 class="text-xl font-bold text-gray-800 mt-4 mb-2">Words in this lesson</h3>
<form method="post" action="{% url 'delete-selected-words' my_lesson.id %}">
    {% csrf_token %}
    <label class="mb-2 inline-block">
        <input type="checkbox" id="select-all" /> Select all
    </label>
    <table class="w-auto table-auto border-collapse text-left">
        <thead>
            <tr>
                <th class="px-3 py-2">Prompt <br>({{my_lesson.lesson.prompt_language}})</th>
                <th class="px-3 py-2">Translation <br> ({{my_lesson.lesson.translation_language}})</th>
                <th class="px-2 py-2 text-center">Progress</th>
                <th class="px-2 py-2 text-center">Details</th>
                <th class="px-2 py-2 text-center">Edit</th>
                <th class="px-2 py-2 text-center">Select</th>
            </tr>
        </thead>
        <tbody>
            {% for my_word in my_words %}
            <tr>
                <td class="px-3 py-2">{{ my_word.word.prompt }}</td>
                <td class="px-3 py-2">{{ my_word.word.translation }}</td>
                <td class="px-2 py-2 text-center">{{ my_word.current_progress }}</td>
                <td class="px-2 py-2 text-center">
                    <a href="{% url 'my-word-details' my_word.id %}" class="underline">View</a>
                </td>
                <td class="px-2 py-2 text-center">
                    <form action="{% url 'edit-word' my_word.id %}" method="get" style="display:inline;">
                        <button type="submit" {% if not can_edit %}disabled{% endif %} class="underline">Edit</button>
                    </form>
                <td class="px-2 py-2 text-center">
                    <input type="checkbox" name="selected_words" value="{{ my_word.word.id }}">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="bg-red-300 px-2 py-1 border border-gray-400 rounded text-gray-800 hover:bg-red-400 text-sm cursor-pointer mb-4 mt-2">
        Delete selected words
    </button>
</form>

<script>
document.getElementById('select-all').addEventListener('change', function(e) {
    document.querySelectorAll('input[name="selected_words"]').forEach(cb => cb.checked = e.target.checked);
});
</script>

{% endblock content %}